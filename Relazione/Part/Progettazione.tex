\section{Progettazione}
\subsection{Introduzione}
In questa sezione verrà approfondita tutto ciò che riguarda la progettazione ed
il design del sistema.
\subsection{Use Case Diagrams}
Tra le prime cose di cui ci siamo occupati per lo sviluppo di questa applicazione
ci sono gli use case diagrams. La realizzazione di questi diagrammi ci hanno permesso
di individuare e dividere le operazioni che ogni utente dell'applicazione sarebbe stato
in grado di compiere Figura \ref{fig:Use case diagrams}
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{Resources/graficiUML/UseCaseDiagram.png}        
    \caption{Use case diagrams degli attori dell'applicazione.}
    \label{fig:Use case diagrams}
\end{figure}
\todo[color=blue]{Andre scrivi il paragrafo 3 sul database ovvero parla di hibernate,transaction manager e come hai annotato le clsse e del
    database in memoria}
\todo[color=blue]{Se vuoi scrivi della gui in generale}
\todo[color=green]{Nicco crea gli use case template scegline qualcuno che ritieni significativo NON login e register}

\subsection{Use Case Templates}

\subsection{Creazione lega}
\begin{table}[H]
\caption{Crea fantalega}
\label{UC-01}

\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Id} & UC-01 (Crea fantalega) \\
\hline
\textbf{Scope} & user goal \\
\hline
\textbf{Descrizione} & L'utente vuole creare una nuova fantalega di cui sarà admin. \\
\hline
\textbf{Attori} & Admin \\
\hline
\textbf{Flusso base} &
\begin{enumerate}[leftmargin=*]
    \item L'utente inserisce il nome e il codice della lega che vuole creare (\hyperref[fig:mockup_parte3]{GUI 3.d}).
    \item Il sistema verifica che non sia già presente una lega con lo stesso codice.
    \item Se i dati sono validi, il sistema crea la nuova lega.
\end{enumerate} \\
\hline
\textbf{Flusso alternativo} &
\begin{enumerate}[leftmargin=*,label=2.\arabic*]
    \item Il codice scelto è già utilizzato per un'altra lega.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} \\
\hline
\textbf{Test} & \hyperref[IT1]{IT1} \\
\hline
\end{tabularx}

\end{table}


\subsubsection{Assegna giocatori ai teams}
\begin{table}[H]
\caption{Assegna giocatori ai teams}
\label{UC-02}

\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Id} & UC-02 (Assegna giocatori ai teams) \\
\hline
\textbf{Scope} & user goal \\
\hline
\textbf{Descrizione} & L'admin vuole assegnare i giocatori corretti ai teams presenti nella lega. \\
\hline
\textbf{Attori} & Admin \\
\hline
\textbf{Flusso base} &
\begin{enumerate}[leftmargin=*]
    \item L'admin inserisce il team e il giocatore che deve essere assegnato a tale team (\hyperref[fig:mockup_parte4]{GUI 4.c}).
    \item Il sistema verifica che il numero massimo di giocatori nel team non sia già stato raggiunto.
    \item Il sistema verifica che il numero massimo di giocatori nel team appartenenti allo 
            stesso ruolo del nuovo giocatore non sia già stato raggiunto.
    \item Il sistema salva il nuovo contratto tra team e giocatore.
\end{enumerate} \\
\hline
\textbf{Flusso alternativo} &
\begin{enumerate}[leftmargin=*,label=2.\arabic*]
    \item Il numero massimo di giocatori nel team è già stato raggiunto.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate}
\begin{enumerate}[leftmargin=*,label=3.\arabic*]
    \item Il numero massimo di giocatori nel team appartenenti allo stesso ruolo
            del nuovo giocatore è già stato raggiunto.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} \\
\hline
\textbf{Test} & \hyperref[IT2]{IT2} \\
\hline
\end{tabularx}

\end{table}


\subsubsection{Inserisci formazione}
\begin{table}[H]
\caption{Inserisci formazione}
\label{UC-03}

\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Id} & UC-03 (Inserisci formazione) \\
\hline
\textbf{Scope} & user goal \\
\hline
\textbf{Descrizione} & L'utente vuole inserire la formazione per giocare la partita successiva. \\
\hline
\textbf{Attori} & FantaUser \\
\hline
\textbf{Flusso base} &
\begin{enumerate}[leftmargin=*]
    \item L'utente fornisce la LineUp che vuole utilizzare per la partita successiva.
    \item Il sistema verifica che la data in cui viene effettuata l'operazione 
            sia precedente alla data della partita.
    \item Il sistema verifica che la data in cui viene effettuata l'operazione 
            non sia un sabato o una domenica.
    \item Se la partita non è la prima del campionato, il sistema verifica che 
            i voti per la partita precedente siano già stati calcolati. 
    \item Il sistema verifica che i giocatori appartenenti alla formazione 
            siano giocatori posseduti dall'utente.
    \item Se l'utente ha già stata inserito una formazione per la partita, 
            il sistema la elimina per poter inserire la nuova formazione.
    \item Il sistema salva la formazione per la partita successiva.
\end{enumerate} \\
\hline
\textbf{Flusso alternativo} &
\begin{enumerate}[leftmargin=*,label=2.\arabic*]
    \item La data in cui viene effettuata l'operazione è successiva alla data della partita.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate}
\begin{enumerate}[leftmargin=*,label=3.\arabic*]
    \item La data in cui viene effettuata l'operazione è un sabato o una domenica.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} 
\begin{enumerate}[leftmargin=*,label=4.\arabic*]
    \item I voti per la partita precedente non sono stati ancora calcolati.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate}
\begin{enumerate}[leftmargin=*,label=5.\arabic*]
    \item C'è almeno un giocatore all'interno della formazione che non appartiene all'utente.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} \\
\hline
\textbf{Test} & \hyperref[IT3]{IT3} \\
\hline
\end{tabularx}

\end{table}


\subsubsection{Crea proposta di scambio}
\begin{table}[H]
\caption{Scambia giocatori - Invia proposta}
\label{UC-04}

\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Id} & UC-04 (Scambia giocatori - Invia proposta) \\
\hline
\textbf{Scope} & user goal \\
\hline
\textbf{Descrizione} & L'utente vuole inviare una proposta di scambio di giocatori ad un altro utente. \\
\hline
\textbf{Attori} & FantaUser \\
\hline
\textbf{Flusso base} &
\begin{enumerate}[leftmargin=*]
    \item L'utente fornisce i giocatori coinvolti nello scambio e le relative rose (\hyperref[fig:mockup_parte3]{GUI 3.c}).
    \item Il sistema verifica che i due giocatori abbiano lo stesso ruolo.
    \item Il sistema verifica che i giocatori coinvolti appartengano alle rose fornite dall'utente.
    \item Viene creata la nuova proposta e si verifica se è già presente una 
            proposta con le stesse caratteristiche.
    \item Il sistema salva la nuova proposta.
\end{enumerate} \\
\hline
\textbf{Flusso alternativo} &
\begin{enumerate}[leftmargin=*,label=2.\arabic*]
    \item I due giocatori coinvolti nello scambio non hanno lo stesso ruolo.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate}
\begin{enumerate}[leftmargin=*,label=3.\arabic*]
    \item I giocatori coinvolti nello scambio non appartengono alle rose fornite dall'utente
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} 
\begin{enumerate}[leftmargin=*,label=4.\arabic*]
    \item Nel sistema è già presente una proposta con le stesse caratteristiche.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} \\
\hline
\textbf{Test} & \hyperref[IT4]{IT4} \\
\hline
\end{tabularx}

\end{table}


\subsubsection{Accetta proposta di scambio}
\begin{table}[H]
\caption{Scambia giocatori - Accetta proposta}
\label{UC-05}

\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Id} & UC-05 (Scambia giocatori - Accetta proposta) \\
\hline
\textbf{Scope} & user goal \\
\hline
\textbf{Descrizione} & L'utente vuole accettare una proposta di scambio di giocatori inviata da un altro utente. \\
\hline
\textbf{Attori} & FantaUser \\
\hline
\textbf{Flusso base} &
\begin{enumerate}[leftmargin=*]
    \item L'utente fornisce la proposta che vuole accettare e la propria rosa.
    \item Il sistema verifica che la rosa fornita sia coinvolta nella proposta.
    \item Il sistema verifica che entrambi i contratti dei giocatori coinvolti siano ancora presenti.
    \item La proposta è accettata, quindi il sistema provvede a modificare i contratti dei giocatori
            per cambiare la loro squadra di appartenenza.
    \item Il sistema salva i nuovi contratti. 
\end{enumerate} \\
\hline
\textbf{Flusso alternativo} &
\begin{enumerate}[leftmargin=*,label=2.\arabic*]
    \item La rosa fornita non è coinvolta nella proposta.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate}
\begin{enumerate}[leftmargin=*,label=3.\arabic*]
    \item Il contratto di almeno uno dei giocatori coinvolti non è più presente.
    \item Il sistema provvede a rifiutare la proposta dato che non è valida.
    \item Il sistema mostra a schermo un messaggio di errore, specificando la causa del problema.
\end{enumerate} \\
\hline
\textbf{Test} & \hyperref[IT5]{IT5} \\
\hline
\end{tabularx}

\end{table}



\subsection{GUI-Mockups}
\begin{figure}[H]
    \centering

    % 1ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/Login.png}
        \caption{Mockup della pagina di login.}
        \label{fig:pagina_login}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/Registrazione.png}
        \caption{Mockup della pagina di registrazione.}
        \label{fig:pagina_registrazione}
    \end{subfigure}

    % 2ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/HomePage.png}
        \caption{Mockup della homepage.}
        \label{fig:pagina_homepage}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/Classifica.png}
        \caption{Mockup della classifica.}
        \label{fig:pagina_classifica}
    \end{subfigure}

    \caption{Mockup delle pagine di accesso e homepage.}
    \label{fig:mockup_parte1}
\end{figure}
\begin{figure}[H]
    \centering

    % 3ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/Squadre.png}
        \caption{Mockup della pagina delle squadre.}
        \label{fig:pagina_squadre}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/VisualizzaSquadra.png}
        \caption{Mockup pagina di visualizzazione di un team.}
        \label{fig:pagina_visualizza_squadra}
    \end{subfigure}

    % 4ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/Calendario.png}
        \caption{Mockup della pagina del calendario.}
        \label{fig:pagina_calendario}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/VisualizzaMatch.png}
        \caption{Mockup pagina di visualizzazione di un match.}
        \label{fig:pagina_visualizza_match}
    \end{subfigure}

    \caption{Mockup delle pagine relative a squadre, calendario e match.}
    \label{fig:mockup_parte2}
\end{figure}
\clearpage
\begin{figure}[H]
    \centering

    % 5ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/ProposteAttive.png}
        \caption{Mockup della pagina delle proposte attive.}
        \label{fig:pagina_proposte_attive}
    \end{subfigure}
    \hfill
   
    % 6ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/CreaProposta.png}
        \caption{Mockup pagina per la creazione delle proposte.}
        \label{fig:pagina_crea_proposta}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/CreaLega.png}
        \caption{Mockup della pagina di creazione di una lega.}
        \label{fig:pagina_crea_lega}
    \end{subfigure}

    \caption{Mockup delle pagine relative a proposte e creazione di leghe.}
    \label{fig:mockup_parte3}
\end{figure}
\begin{figure}[H]
    \centering

    % 7ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/UniscitiAdUnaLega.png}
        \caption{Mockup della pagina per l'adesione a una lega.}
        \label{fig:pagina_unisciti_lega}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/GestisciLega.png}
        \caption{Mockup della pagina per la gestione della lega.}
        \label{fig:pagina_gestisci_lega}
    \end{subfigure}

    % 8ª riga
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/AssegnaGiocatori.png}
        \caption{Mockup pagina assegnazione dei giocatori ai team.}
        \label{fig:pagina_assegna_giocatori}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.49\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Resources/Mockups/AssegnaVoti.png}
        \caption{Mockup della pagina per l'assegnazione dei voti.}
        \label{fig:pagina_assegna_voti}
    \end{subfigure}

    \caption{Mockup delle pagine di gestione delle leghe e assegnazioni.}
    \label{fig:mockup_parte4}
\end{figure}

Abbiamo iniziato anche a progettare una gui utilizzando Java Swing al momento
abbiamo realizzato solamente la pagina per l'inserimento della formazione Figura \ref{fig:pagina_inserisci_formazione}.
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{Resources/Mockups/InserisciFormazione.png}        
    \caption{Pagina per l'inserimento della formazione.}
    \label{fig:pagina_inserisci_formazione}
\end{figure}
\subsection{ClassDiagram}
In questa sottosezione viene riportato il calss diagram dell'applicazione. Per chiarezza visiva
è sato diviso in più parti.
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{Resources/graficiUML/BusinessClassDiagram.png}        
    \caption{BusinessClassDiagram.}
    \label{fig:business_class_diagram}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{Resources/graficiUML/DALClassDiagram.png}        
    \caption{DAL class diagram.}
    \label{fig:dal_class_diagram}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{Resources/graficiUML/ClassDiagram.png}        
    \caption{Domain class diagram.}
    \label{fig:domain_class_diagram}
\end{figure}

\subsection{Database}
La scelta di usare JPA nella modellazione del dominio ci è sembrata particolarmente vantaggiosa
dal momento che la nostra applicazione non doveva interfacciarsi con un database esistente autonomamente,
ovvero l'app e lo schema del database sarebbero stati sviluppati insieme. 
Le annotazioni JPA nelle classi di dominio
sono servite quindi non soltanto come specifica per l'object-relational mapping, ma grazie alla property
di bootstrap \texttt{hibernate.hbm2ddl.auto = create-drop}, anche per definire univocamente lo schema del database.
In questo modo 
\begin{itemize}
    \item non si pongono problemi di allineamento fra schema db e ORM, in quanto il primo
        è automaticamente desunto dal secondo
    \item la modellazione del dominio può essere rivista e modificata a piacere, incoraggiando
        la ricerca di soluzioni efficaci anche quando scomode da mappare manualmente
\end{itemize}

Principi di gestione della persistenza:
\begin{itemize}
    \item rispetto dei layer: JPA agnosticism nella BL (TransactionManager), Hibernate agnosticism nel DAL
    \item entità applicative vs entità relazionali (cascading)
    \item inheritance vs type mapping
    \item lazy fetching nelle entità vs deep fetching nel DAL
\end{itemize}

Principi di design della GUI:
\begin{itemize}
    \item MVP
    \item MVP, modularità e Dependency Injection (disegno)
    \item private vs public design-time logic
    \item instantiation vs configuration
    \item limiti di AssertJSwing, limiti di WB
\end{itemize}